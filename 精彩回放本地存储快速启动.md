# 精彩回放功能（本地存储版）- 快速启动指南

## 功能说明
本版本使用服务器本地存储视频文件，而不是使用外部URL。视频文件上传到后端服务器的 `media/highlights/videos/` 目录。

## 第一步：更新数据库表结构

在 MySQL 中执行：

```bash
mysql -u root -p123456 nba_platform < 更新精彩回放表结构.sql
```

或者在 MySQL 命令行中：

```sql
source 更新精彩回放表结构.sql;
```

## 第二步：创建媒体文件目录

在后端项目目录运行：

```bash
cd nba_backend

# Windows
.\创建媒体目录.bat

# 或手动创建
mkdir media\highlights\videos
mkdir media\highlights\covers
```

## 第三步：安装 Pillow（图片处理库）

```bash
# 激活虚拟环境
conda activate nba_env

# 安装 Pillow
pip install Pillow
```

## 第四步：运行数据库迁移

```bash
cd nba_backend

# 删除旧的迁移文件
del highlights\migrations\0001_initial.py

# 重新创建迁移
python manage.py makemigrations highlights

# 标记迁移为已完成（因为表已通过SQL创建）
python manage.py migrate highlights --fake

# 启动后端服务
python manage.py runserver
```

## 第五步：启动前端

```bash
cd nba-data-shop-platform

# 启动开发服务器
npm run dev:h5
```

## 使用说明

### 管理员上传视频

1. 登录管理员账号
2. 进入"管理后台" → "精彩回放管理"
3. 点击"添加回放"
4. 填写信息：
   - 标题：例如"詹姆斯关键三分绝杀"
   - 对阵球队：例如"湖人 vs 勇士"
   - 比赛日期：选择日期
   - 视频文件：点击"选择视频"上传视频文件
   - 封面图片：点击"选择图片"上传封面（可选）
   - 时长：会自动获取（秒）
   - 描述：填写精彩回放的描述
5. 点击"提交"

### 用户观看视频

1. 在首页导航栏点击"精彩回放"
2. 浏览精彩回放列表
3. 点击任意视频卡片播放
4. 视频会在弹窗中播放
5. 观看次数会自动统计

## 文件存储说明

### 视频文件
- 存储路径：`nba_backend/media/highlights/videos/`
- 访问URL：`http://127.0.0.1:8000/media/highlights/videos/文件名.mp4`
- 支持格式：mp4, avi, mov 等

### 封面图片
- 存储路径：`nba_backend/media/highlights/covers/`
- 访问URL：`http://127.0.0.1:8000/media/highlights/covers/文件名.jpg`
- 支持格式：jpg, jpeg, png, gif

## 测试视频准备

由于视频文件较大，建议：

1. 准备一些短视频（10-30秒）用于测试
2. 视频格式建议使用 MP4（H.264编码）
3. 分辨率建议：720p 或 1080p
4. 文件大小建议：每个视频不超过50MB

## 常见问题

### Q: 上传视频失败？
A: 检查以下几点：
- media 目录是否已创建
- 文件大小是否超过100MB限制
- 视频格式是否支持
- 后端服务是否正常运行

### Q: 视频无法播放？
A: 检查：
- 浏览器是否支持该视频格式
- 视频文件是否完整
- 后端 MEDIA_URL 配置是否正确

### Q: 封面图片不显示？
A: 确保：
- Pillow 库已安装
- 图片格式正确
- 图片文件路径正确

### Q: 文件上传很慢？
A: 这是正常的，视频文件较大。可以：
- 使用较小的测试视频
- 压缩视频文件
- 在生产环境使用云存储服务

## 目录结构

```
nba_backend/
├── media/
│   └── highlights/
│       ├── videos/          # 视频文件存储
│       │   ├── video1.mp4
│       │   └── video2.mp4
│       └── covers/          # 封面图片存储
│           ├── cover1.jpg
│           └── cover2.jpg
├── highlights/              # 精彩回放应用
│   ├── models.py
│   ├── views.py
│   └── ...
└── manage.py
```

## 优化建议

1. **生产环境**：使用云存储（阿里云OSS、腾讯云COS）
2. **视频压缩**：上传前压缩视频以节省空间和带宽
3. **CDN加速**：使用CDN加速视频访问
4. **转码服务**：统一转码为web友好格式
5. **缩略图生成**：自动生成视频缩略图作为封面
