# NBA篮球数据咨询 - 系统架构

## 🏗️ 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户设备 (User Device)                     │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │           Vue3 + Uni-app 前端应用                         │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │   │
│  │  │   主页面      │  │  登录页面     │  │  新闻详情    │   │   │
│  │  │ (比赛/新闻)   │  │ (注册/登录)   │  │  (详情页)    │   │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘   │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/HTTPS
                              │ REST API
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Nginx 反向代理服务器                           │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  - 负载均衡                                               │   │
│  │  - SSL/TLS加密                                            │   │
│  │  - 静态文件服务                                           │   │
│  │  - 请求转发                                              │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ 本地通信
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                  Gunicorn 应用服务器                              │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │           Django 应用 (多个Worker进程)                    │   │
│  │                                                           │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │              URL 路由层                             │  │   │
│  │  │  /api/auth/  /api/matches/  /api/news/  ...       │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │                      │                                    │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │              视图层 (Views)                         │  │   │
│  │  │  - 认证视图    - 比赛视图    - 新闻视图            │  │   │
│  │  │  - 排行榜视图  - 搜索视图    - 用户视图            │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │                      │                                    │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │            序列化器层 (Serializers)                 │  │   │
│  │  │  - 数据验证    - 数据转换    - 响应格式化          │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │                      │                                    │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │              业务逻辑层                             │  │   │
│  │  │  - 认证逻辑    - 数据处理    - 业务规则            │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │                      │                                    │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │              模型层 (Models)                        │  │   │
│  │  │  - User       - Team        - Match                │  │   │
│  │  │  - News       - NewsLike    - Ranking              │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ SQL查询
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    MySQL 数据库服务器                             │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    数据库 (nba_api)                       │   │
│  │                                                           │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │   │
│  │  │  users表     │  │  teams表     │  │  matches表   │   │   │
│  │  │  sms_codes表 │  │  news表      │  │  rankings表  │   │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘   │   │
│  │                                                           │   │
│  │  ┌──────────────────────────────────────────────────┐   │   │
│  │  │  索引、备份、日志、监控                           │   │   │
│  │  └──────────────────────────────────────────────────┘   │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 数据流图

### 用户登录流程
```
用户输入手机号
    │
    ▼
发送短信验证码请求
    │
    ▼
后端验证手机号格式
    │
    ▼
生成4位验证码
    │
    ▼
保存到数据库 (SmsCode表)
    │
    ▼
调用短信服务发送
    │
    ▼
返回成功响应
    │
    ▼
用户输入验证码
    │
    ▼
发送登录请求
    │
    ▼
后端验证验证码
    │
    ▼
获取或创建用户
    │
    ▼
生成JWT Token
    │
    ▼
返回Token和用户信息
    │
    ▼
前端保存Token
    │
    ▼
登录成功，跳转主页
```

### 获取新闻列表流程
```
用户请求新闻列表
    │
    ▼
前端发送GET请求 + Token
    │
    ▼
Nginx接收请求
    │
    ▼
转发到Gunicorn
    │
    ▼
Django验证Token
    │
    ▼
检查用户权限
    │
    ▼
查询数据库
    │
    ▼
应用排序和分页
    │
    ▼
序列化数据
    │
    ▼
返回JSON响应
    │
    ▼
前端接收数据
    │
    ▼
渲染新闻列表
```

---

## 🔐 认证流程

```
┌─────────────────────────────────────────────────────────────┐
│                    JWT认证流程                               │
│                                                              │
│  1. 用户登录                                                 │
│     ├─ 发送手机号 + 验证码                                   │
│     └─ 后端验证成功                                          │
│                                                              │
│  2. 生成Token                                                │
│     ├─ 创建JWT Token                                         │
│     ├─ 设置过期时间 (7天)                                    │
│     └─ 返回给前端                                            │
│                                                              │
│  3. 前端保存Token                                            │
│     ├─ 存储在本地存储                                        │
│     └─ 每次请求都携带                                        │
│                                                              │
│  4. 后端验证Token                                            │
│     ├─ 检查Token格式                                         │
│     ├─ 验证签名                                              │
│     ├─ 检查过期时间                                          │
│     └─ 获取用户信息                                          │
│                                                              │
│  5. 请求处理                                                 │
│     ├─ Token有效 → 处理请求                                  │
│     └─ Token无效 → 返回401错误                               │
│                                                              │
│  6. Token过期处理                                            │
│     ├─ 返回401错误                                           │
│     ├─ 前端提示重新登录                                      │
│     └─ 用户重新登录获取新Token                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 📱 前端架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Vue3 + Uni-app                            │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              App.vue (根组件)                         │   │
│  │  - 全局状态管理                                       │   │
│  │  - 路由配置                                           │   │
│  │  - 全局样式                                           │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              pages.json (路由配置)                    │   │
│  │  - 页面路由                                           │   │
│  │  - 导航栏配置                                         │   │
│  │  - 页面样式                                           │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              页面组件 (Pages)                         │   │
│  │                                                       │   │
│  │  ┌────────────────┐  ┌────────────────┐             │   │
│  │  │  index.vue     │  │  login.vue     │             │   │
│  │  │  (主页面)      │  │  (登录页面)    │             │   │
│  │  └────────────────┘  └────────────────┘             │   │
│  │                                                       │   │
│  │  ┌────────────────┐                                  │   │
│  │  │  detail.vue    │                                  │   │
│  │  │  (新闻详情)    │                                  │   │
│  │  └────────────────┘                                  │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              API调用层                               │   │
│  │  - HTTP请求                                          │   │
│  │  - Token管理                                         │   │
│  │  - 错误处理                                          │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              状态管理                                 │   │
│  │  - 用户信息                                          │   │
│  │  - 认证状态                                          │   │
│  │  - 缓存数据                                          │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 🗄️ 数据库设计

```
┌─────────────────────────────────────────────────────────────┐
│                    数据库表结构                               │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  users (用户表)                                       │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ phone (手机号, 唯一)                              │   │
│  │  ├─ username (用户名)                                 │   │
│  │  ├─ password (密码, 加密)                             │   │
│  │  ├─ avatar (头像)                                     │   │
│  │  ├─ created_at (创建时间)                             │   │
│  │  └─ updated_at (更新时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  sms_codes (短信验证码表)                             │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ phone (手机号)                                    │   │
│  │  ├─ code (验证码)                                     │   │
│  │  ├─ is_used (是否已使用)                              │   │
│  │  ├─ expires_at (过期时间)                             │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  teams (球队表)                                       │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ name (球队名称)                                   │   │
│  │  ├─ city (城市)                                       │   │
│  │  ├─ logo (标识)                                       │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  matches (比赛表)                                     │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ date (比赛日期)                                   │   │
│  │  ├─ team1_id (主队ID, 外键)                           │   │
│  │  ├─ team2_id (客队ID, 外键)                           │   │
│  │  ├─ team1_score (主队得分)                            │   │
│  │  ├─ team2_score (客队得分)                            │   │
│  │  ├─ status (比赛状态)                                 │   │
│  │  ├─ viewers (观看人数)                                │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  news (新闻表)                                        │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ title (标题)                                      │   │
│  │  ├─ content (内容)                                    │   │
│  │  ├─ image (配图)                                      │   │
│  │  ├─ source (来源)                                     │   │
│  │  ├─ author (作者)                                     │   │
│  │  ├─ comments (评论数)                                 │   │
│  │  ├─ likes (点赞数)                                    │   │
│  │  ├─ shares (分享数)                                   │   │
│  │  ├─ created_at (创建时间)                             │   │
│  │  └─ updated_at (更新时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  news_likes (新闻点赞表)                              │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ user_id (用户ID, 外键)                            │   │
│  │  ├─ news_id (新闻ID, 外键)                            │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  team_rankings (球队排行榜表)                         │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ rank (排名)                                       │   │
│  │  ├─ team_id (球队ID, 外键)                            │   │
│  │  ├─ team_name (球队名称)                              │   │
│  │  ├─ wins (胜场)                                       │   │
│  │  ├─ losses (负场)                                     │   │
│  │  ├─ win_rate (胜率)                                   │   │
│  │  ├─ points_for (得分)                                 │   │
│  │  ├─ points_against (失分)                             │   │
│  │  ├─ season (赛季)                                     │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  player_rankings (球员排行榜表)                       │   │
│  │  ├─ id (主键)                                         │   │
│  │  ├─ rank (排名)                                       │   │
│  │  ├─ player_id (球员ID)                                │   │
│  │  ├─ player_name (球员名称)                            │   │
│  │  ├─ team_name (球队名称)                              │   │
│  │  ├─ value (数值)                                      │   │
│  │  ├─ games (比赛数)                                    │   │
│  │  ├─ stat_type (统计类型)                              │   │
│  │  ├─ season (赛季)                                     │   │
│  │  └─ created_at (创建时间)                             │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 API请求响应流程

```
┌─────────────────────────────────────────────────────────────┐
│                    API请求响应流程                            │
│                                                              │
│  前端                                                        │
│    │                                                         │
│    │ 1. 构建请求                                             │
│    │    - 方法 (GET/POST/PUT/DELETE)                        │
│    │    - URL                                                │
│    │    - 请求头 (Authorization, Content-Type)              │
│    │    - 请求体 (JSON)                                      │
│    │                                                         │
│    ▼                                                         │
│  Nginx                                                       │
│    │                                                         │
│    │ 2. 接收请求                                             │
│    │    - 验证SSL/TLS                                        │
│    │    - 解析请求                                           │
│    │    - 转发到Gunicorn                                     │
│    │                                                         │
│    ▼                                                         │
│  Gunicorn                                                    │
│    │                                                         │
│    │ 3. 分配Worker                                           │
│    │    - 选择可用Worker                                     │
│    │    - 传递请求                                           │
│    │                                                         │
│    ▼                                                         │
│  Django                                                      │
│    │                                                         │
│    │ 4. 路由匹配                                             │
│    │    - 匹配URL模式                                        │
│    │    - 调用对应视图                                       │
│    │                                                         │
│    │ 5. 认证检查                                             │
│    │    - 验证Token                                          │
│    │    - 检查权限                                           │
│    │                                                         │
│    │ 6. 业务处理                                             │
│    │    - 验证数据                                           │
│    │    - 查询数据库                                         │
│    │    - 处理业务逻辑                                       │
│    │                                                         │
│    │ 7. 序列化数据                                           │
│    │    - 转换为JSON                                         │
│    │    - 格式化响应                                         │
│    │                                                         │
│    ▼                                                         │
│  数据库                                                      │
│    │                                                         │
│    │ 8. 数据操作                                             │
│    │    - 查询                                               │
│    │    - 插入                                               │
│    │    - 更新                                               │
│    │    - 删除                                               │
│    │                                                         │
│    ▼                                                         │
│  Django                                                      │
│    │                                                         │
│    │ 9. 返回响应                                             │
│    │    - 状态码                                             │
│    │    - 响应头                                             │
│    │    - 响应体 (JSON)                                      │
│    │                                                         │
│    ▼                                                         │
│  Gunicorn                                                    │
│    │                                                         │
│    │ 10. 返回给Nginx                                         │
│    │                                                         │
│    ▼                                                         │
│  Nginx                                                       │
│    │                                                         │
│    │ 11. 返回给前端                                          │
│    │                                                         │
│    ▼                                                         │
│  前端                                                        │
│    │                                                         │
│    │ 12. 处理响应                                            │
│    │     - 检查状态码                                        │
│    │     - 解析JSON                                          │
│    │     - 更新UI                                            │
│    │                                                         │
│    ▼                                                         │
│  用户看到结果                                                │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 部署架构

```
┌─────────────────────────────────────────────────────────────┐
│                    生产环境部署架构                            │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              互联网 (Internet)                        │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│                      │ HTTPS (443)                           │
│                      ▼                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Nginx (反向代理)                         │   │
│  │  - SSL/TLS加密                                        │   │
│  │  - 负载均衡                                           │   │
│  │  - 静态文件服务                                       │   │
│  │  - 请求转发                                          │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│                      │ 本地通信 (8000)                       │
│                      ▼                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Gunicorn (应用服务器)                    │   │
│  │  ┌────────────────────────────────────────────────┐  │   │
│  │  │  Worker 1  │  Worker 2  │  Worker 3  │ ...    │  │   │
│  │  │  (Django)  │  (Django)  │  (Django)  │        │  │   │
│  │  └────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────┘   │
│                      │                                       │
│                      │ SQL查询                               │
│                      ▼                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              MySQL (数据库)                          │   │
│  │  - 主从复制                                          │   │
│  │  - 备份策略                                          │   │
│  │  - 性能优化                                          │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Supervisor (进程管理)                    │   │
│  │  - 监控Gunicorn                                       │   │
│  │  - 自动重启                                           │   │
│  │  - 日志管理                                           │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              监控和日志                               │   │
│  │  - 性能监控                                           │   │
│  │  - 错误日志                                           │   │
│  │  - 访问日志                                           │   │
│  │  - 告警系统                                           │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 📈 系统特性

### 可扩展性
- 模块化设计
- 易于添加新功能
- 支持水平扩展

### 可维护性
- 清晰的代码结构
- 详细的文档
- 统一的编码规范

### 可靠性
- 错误处理
- 数据备份
- 监控告警

### 安全性
- JWT认证
- 密码加密
- 输入验证
- CORS配置

### 性能
- 数据库索引
- 缓存支持
- 分页处理
- 异步任务

---

## 🎯 系统流程总结

1. **用户访问** → 前端应用加载
2. **用户登录** → 获取JWT Token
3. **发送请求** → 携带Token
4. **Nginx转发** → 到Gunicorn
5. **Django处理** → 业务逻辑
6. **数据库操作** → 查询/更新
7. **返回响应** → JSON格式
8. **前端渲染** → 显示结果

---

这个架构设计遵循现代Web应用的最佳实践，具有高可用性、可扩展性和可维护性。
